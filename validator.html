<!DOCTYPE html>
<html lang="en">
<head>
<meta charset=utf-8 />
<title>Marbles Squared Validator</title>
<style>
* { font-family: sans-serif; }
textarea {
  font-size: 16px;
  padding: 10px;
  width: 90%;
  height: 100px;
}
#result {
  padding: 5px;
  color: #fff;
}
#result.ok {
  background: #0c0;
}
#result.fail {
  background: #c00;
}
</style>
</head>
<body>
  <form>
    <textarea id="data">{"tagged":{"1":{"taps":[[2,3],[2,3],[3,2],[2,1],[2,0],[1,1],[1,0],[0,0],[0,0],[1,2],[0,1],[5,4],[5,3],[5,2],[4,0],[3,0]],"start":1277332132225,"end":1277332152206}},"seed":"4C228AA4","score":544,"level":1}</textarea>
    <input type="submit" value="Validate Score" />
    <p id="result"></p>
  </form>
<script src="marbles.js"></script>
<script>

document.querySelector('form').addEventListener('submit', function (event) {
  event.preventDefault();
  run();
}, false);

function run() {
  var ta = document.querySelector('textarea'),
      data = JSON.parse(ta.value),
      result = document.querySelector('#result'),
      dim = { grid: [7,7], types: 3 },
      start,
      end;

  Marbles.gameover(function () {
    // console.log('game over: ' + this.getScore());
  });
  Marbles.newGame();
  Marbles.seed(data.seed);
  Marbles.init(dim.grid[0], dim.grid[1], dim.types);

  if (data.data && data.data.tagged) {
    data = data.tagged; 
  }

  for (var level = 1; level <= data.level; level++) { 
    start = data.tagged[level].start;
    end = data.tagged[level].end;
    if (end - start > 10 * 1000) {
      Marbles.bonusFinished();
    } 
    
    for (var i = 0; i < data.tagged[level].taps.length; i++) {
      Marbles.get(data.tagged[level].taps[i][0], data.tagged[level].taps[i][1]).tag();
      Marbles.clear();
    }
    
    if (Marbles.marblesLeft() !== 0) {
      // end of game
      result.innerHTML = 'Game over: final level: ' + level + ', actual level: ' + Marbles.level + ', given score: ' + data.score + ', actual score: ' + Marbles.getScore();
      result.className = data.score == Marbles.getScore() ? 'ok' : 'fail';
      
    } else {
      // level up and continue
      Marbles.levelUp();
      Marbles.init(dim.grid[0], dim.grid[1], dim.types);
    }
  }
}
</script>
</body>
</html>